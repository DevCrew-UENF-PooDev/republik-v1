<%= stylesheet_link_tag "components/templatee/home_component" %>

<div class="main-content">
  <%= render(Organisms::Header::NavbarComponent.new()) %>
  <section>
    <div class="sidebar">
      <h2>Amigos</h2>
      <div class="sidebar-section">
        <!-- Amigo 1 -->
        <div class="friend">
          <%= image_tag("icons/PerfilImagePlaceHolder.svg", :alt => "Avatar de Rivera Escriva", :class => "avatar") %>
          <div class="friend-info">
            <div class="friend-header">
              <span class="name">Rivera Escriva</span>
              <span class="date">01/09/2024</span>
            </div>
            <p class="status">¬øTermin√≥ el trabalho?</p>
          </div>
          <span class="status-indicator online"></span>
        </div>

        <!-- Amigo 2 -->
        <div class="friend">
          <%= image_tag("icons/PerfilImagePlaceHolder.svg", :alt => "Avatar de Enzo Alberix", :class => "avatar") %>
          <div class="friend-info">
            <div class="friend-header">
              <span class="name">Enzo Alberix</span>
              <span class="date">20/08/2024</span>
            </div>
            <p class="status">Assistiu o √∫ltimo ep de OP?</p>
          </div>
          <span class="status-indicator online"></span>
        </div>
      </div>

      <h2>Comunidades</h2>
      <div class="comunidade-search">
        <%= form_with(url: search_community_path, method: :get, remote: true, class: "search-form", data: { turbo_stream: true }) do |form| %>
          <div class="form-group">
            <%= form.label :query, "Buscar Comunidades", class: "sr-only" %>
            <%= form.text_field :query, class: "form-control", placeholder: "Buscar comunidades..." %>
          </div>
          <div class="form-group">
            <%= form.submit "Buscar", class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>

      <%= render partial: "home/communities", locals: { communities: @communities, comunidades_participadas: @comunidades_participadas } %>
    </div>

    <!-- Separar depois em Post -->
    <div class="posts-container">
      <% @posts.each do |postagem| %>
        <div class="post-card">
          <!-- Cabe√ßalho -->
          <div class="post-header">
            <%= image_tag("icons/ComunidadeImagePerfilPlaceHolder.svg", :alt => "Icone Comunidade", :class => "community-icon") %>
            <div class="post-info">
              <div class="community-name"><%= postagem.comunidade.try(:nome) || "Sem comunidade" %></div>
              <div class="user-name"><%= postagem.usuario.nome %></div>
            </div>
            <div class="post-options">
              <span class="icon-options">‚ãÆ</span>
            </div>
          </div>

          <!-- Conte√∫do da Postagem -->
          <div class="post-content">
            <h1><%= postagem.titulo %></h1>
            <p><%= postagem.resumo %></p>
          </div>

          <!-- Rodap√© -->
          <div class="post-footer">
            <div class="post-reactions">
              <% if postagem.usuario_reagiu?(helpers.current_usuario) %>
                <%= button_to '‚ùå Remover Rea√ß√£o', postagem_reacoes_path(postagem_id: postagem.id, tipo: 'like'), remote: true, method: :post, class: "reaction-button" %>
              <% else %>
                <%= button_to 'üëç Reagir', postagem_reacoes_path(postagem_id: postagem.id, tipo: 'like'), remote: true, method: :post, class: "reaction-button" %>
              <% end %>
              <!-- <%= button_to 'üëç', postagem_reacoes_path(postagem_id: postagem.id, tipo: 'like'), remote: true, method: :post, class: "reaction-button" %> -->
              <!-- <button class="reaction-button">üëç Rea√ß√µes</button> -->
              <button class="comment-button" data-post-id="<%= postagem.id %>">üí¨ Comentar</button>
            </div>
            <div class="post-stats">
              <span class="views-count"><%= postagem.total_reacoes %></span> Rea√ß√µes ‚Ä¢ 
              <span class="comments-count"><%= postagem.total_comentarios %> coment√°rios</span>
            </div>
          </div>

          <!-- Coment√°rios -->
          <div class="post-comments">
            <%= form_with(model: [postagem, Comentario.new], local: true) do |form| %>
              <div class="form-group comment-form" data-post-id="<%= postagem.id %>" style="display: none;">
                <%= form.text_area :conteudo, class: "form-control", placeholder: "Adicionar um coment√°rio" %>
                <%= helpers.inline_svg 'icons/send.svg', alt: "Submit Message", class: "logo" %>
                <%= form.submit "Submit", :type => :image, :src => image_path("icons/send.svg") %>
              </div>
            <% end %>
            <% postagem.comentarios.each do |comentario| %>
              <div class="comment">
                <div class="user-comment-info">
                  <%= image_tag("icons/PerfilImagePlaceHolder.svg", :alt => "Avatar de Enzo Alberix", :class => "avatar") %>
                  <strong><%= comentario.nome_autor %></strong>
                  <p class="last-activity">‚Ä¢ Realizado h√° <%= time_ago_in_words(comentario.updated_at) %> ‚Ä¢</p>
                </div>
                <p class="comment-content"><%= comentario.conteudo %></p>
                <hr>
              </div>
            <% end %>
          </div>
        </div>      
      <% end %>
    </div>
  </section>
</div>
